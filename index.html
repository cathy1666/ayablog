<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Aya Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="Aya Blog">
<meta property="og:url" content="http://cathy1666.github.io/ayablog/index.html">
<meta property="og:site_name" content="Aya Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Aya Blog">
  
    <link rel="alternate" href="/atom.xml" title="Aya Blog" type="application/atom+xml">
  
  <link rel="icon" href="/ayablog/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/ayablog/css/style.css">

  <script src="/ayablog/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/ayablog/css/bootstrap.css" >
  <link rel="stylesheet" href="/ayablog/css/fashion.css" >
  <link rel="stylesheet" href="/ayablog/css/glyphs.css" >

</head>



  <body>


  


<header id="allheader" class="site-header" role="banner" 
   >
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/ayablog/" title="Aya Blog" rel="home"> Aya Blog </a>
            
          </h1>
          
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/ayablog/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/ayablog/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/ayablog/tags">Tags</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/ayablog/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main">
  
    <article id="post-Azure IoT Wokeshop筆記"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/ayablog/2017/02/24/Azure IoT Wokeshop筆記/">Azure IoT Wokeshop筆記</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/ayablog/2017/02/24/Azure IoT Wokeshop筆記/" class="article-date">
	  <time datetime="2017-02-23T16:00:00.000Z" itemprop="datePublished">February 24, 2017</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="General-IOT-Architecture"><a href="#General-IOT-Architecture" class="headerlink" title="General IOT Architecture"></a>General IOT Architecture</h2><img src="/ayablog/2017/02/24/Azure%20IoT%20Wokeshop筆記/AzureIoTReferenceArchitecture.png" alt="IoT_general_架構圖" title="IoT_general_架構圖">
<p>上圖為一般性的IoT Solution架構，我把它分成四大階段:</p>
<ul>
<li>資料蒐集與傳送</li>
<li>雲端運算及管理</li>
<li>數據呈現</li>
<li>設備控制</li>
</ul>
<h3 id="資料蒐集與傳送"><a href="#資料蒐集與傳送" class="headerlink" title="資料蒐集與傳送"></a>資料蒐集與傳送</h3><p>蒐集 Data 並將 Data 上傳雲端是 Device 主要的兩項工作，但為了做到傳資料到雲端，Device 還需要有向雲端註冊，打通連線的功能。<br>而 Device 是代表所有在現場端可產生感興趣資訊的設備，例如：</p>
<ul>
<li>智慧家庭應用中，Device 就是電視、冰箱、冷氣等設備</li>
<li>醫療場所則可能為血壓計、血糖機、睡眠偵測儀等</li>
<li>應用在工廠則可把機械手臂視作Device。</li>
</ul>
<p>在這個架構中，Device 又分成兩類：</p>
<ol>
<li>IP capable device<ul>
<li>有運算能力且有連網能力，可以直接在 device 上寫程式，由 device自行完成上傳資料的工作</li>
</ul>
</li>
<li>Legacy IoT device / Low power device<ul>
<li>低功率設備,較老舊,無連網能力,需在現場而外再接一個 field gateway，透過 len protocol 跟 field gateway溝通聯網，這種就是在 field gateway上寫程式。</li>
<li>ex: 工廠機械手臂</li>
</ul>
</li>
</ol>
<h3 id="雲端運算及管理"><a href="#雲端運算及管理" class="headerlink" title="雲端運算及管理"></a>雲端運算及管理</h3><p>雖然圖中分成好幾個區塊，但從 Clould Gateway 開始整個都是在雲端上進行的了。</p>
<ul>
<li>Clould Gateway<ul>
<li>和現場端溝通的介面</li>
<li>收現場資料</li>
<li>對現場設備發指令</li>
<li>考慮scale很重要(需連線多少台現場設備?)</li>
</ul>
</li>
<li>Device Management Portal<ul>
<li>雲端管理操作介面，可能是一個網頁，可以透過此介面設定及查看雲端需處理的工作項目，甚至是透過此介面可直接開發雲端程式。</li>
</ul>
</li>
<li>Provisioning API<ul>
<li>設備身分驗證註冊</li>
</ul>
</li>
<li>Identity &amp; Registry Stores<ul>
<li>身分管理</li>
<li>可能是Portal進入雲端的使用者權限管理，例如一般使用者只能查看設備狀態，開發者可以坐雲端設定的更動等等</li>
<li>另外也有可能不同案場使用同一個雲來管理，就規劃某Portal帳號只能查看或控制該案場所屬的那些設備</li>
</ul>
</li>
<li>Device State Store<ul>
<li>設備目前狀態查詢，因為上傳一定多少會有delay，所以不能保證是及時，但可以保證是最新的一筆資料。</li>
</ul>
</li>
<li>Stream Event Processor<ul>
<li>做IoT最關心的是”資料”，此模組是對即時流進來的資料做處理，例如設定一個門檻值，如果工廠機器溫度過高就立刻下命令關掉它。</li>
</ul>
</li>
<li>Storage<ul>
<li>所有raw data歷史資料儲存區域，為了將來可以做大數據分析，一般是建議即使是現在沒用到的資料都要完整保存。這部分的重點在於data要用怎樣的方式存取，資料庫欄位要如何設計等。</li>
</ul>
</li>
<li>Analytics / Machine Learning<ul>
<li>用蒐集來的資料做大數據分析，預測一些事情，或是做機器學習讓一些應用流程更加自動化。</li>
<li>ex: 預測冷氣何時需要換濾心</li>
<li>ex: 預測工廠何時需要維修，何時會壞掉需要更換</li>
</ul>
</li>
</ul>
<h3 id="數據呈現"><a href="#數據呈現" class="headerlink" title="數據呈現"></a>數據呈現</h3><p>用人能了解的方式把你的資料呈現給使用著看，此部分注重的是資料更新的頻率，以及成現的方式，一般的作法有：</p>
<ul>
<li>做成報表</li>
<li>dashboard</li>
</ul>
<h3 id="設備控制"><a href="#設備控制" class="headerlink" title="設備控制"></a>設備控制</h3><p>控制的部分在這張架構圖沒有明確畫出來，但是會選擇使用 cloud 架構的主要原因之一，就是要做遠端控制。像我們目前遇到的需求，就是希望可以手機APP在外面直接透過 3G/4G 網路，控制現場端的設備。</p>
<p>其實設備控制的動作跟第一階段的資料傳送的架構很像，都是現場端 gateway 與 cloud gateway 之間做通訊的動作，差別在於資料傳送是由現場端 gateway 「主動」 建立連線傳送資料，而設備控制是則由 cloud gateway 「主動」 發起連線，所以現場端 gateway 與 cloud gateway 之間需要有雙向溝通的機制。</p>
<p>不過這樣也只是從雲端的 portal 介面去下控制命令而已，若是需要從手機 APP 透過雲端對設備做控制，還需要額外有一個 APP Server 的角色來接起手機和雲端之間的通訊，而實際架構會長怎樣就有很多種做法了，所以沒話在這張圖中，下面舉例 Azure 架構下可實行的一些做法。</p>
<hr>
<h2 id="Microsof-Azure-服務架構圖"><a href="#Microsof-Azure-服務架構圖" class="headerlink" title="Microsof Azure 服務架構圖"></a>Microsof Azure 服務架構圖</h2><p>這張是對應上面一般性架構圖，講解微軟 Azure IoT Platform 的架構、目前有的服務，以及可提供的支援，當然還有\$\$\$。</p>
<img src="/ayablog/2017/02/24/Azure%20IoT%20Wokeshop筆記/MicrosoftAzureIoTPlatform01.png" alt="Microsoft_Azure_架構圖" title="Microsoft_Azure_架構圖">
<h3 id="On-Prem-Device"><a href="#On-Prem-Device" class="headerlink" title="On-Prem Device"></a>On-Prem Device</h3><p>如同上一段介紹的，和雲端通訊的工作，必須根據現場端(On-Prem)資料收集設備的能力，來決定是否需要多加一個 Field Gateway。</p>
<h4 id="Field-Gateway-種類"><a href="#Field-Gateway-種類" class="headerlink" title="Field Gateway 種類"></a>Field Gateway 種類</h4><p>如果決定外加一個 Field Gateway，那通常就是由 Field Gateway 統整完當下所有 device 的 data 後，在包成一條 message 給 cloud ，這樣比較省錢，因為 cloud 收費除了看流量也有看筆數。至於那條 message 要怎麼包，依需求又可分為兩種做法:</p>
<ol>
<li>Transparence Field Gateway:</li>
</ol>
<p>上傳給 Cloud 的 message 中記載每個 data 各自從一個 device 得到，相當於 Cloud 直接從 device 得到 data，而不會知道 Field Gateway 是誰，此種 Gateway 就是透明的(transparence)。</p>
<ol>
<li>Opaque Field Gateway:</li>
</ol>
<p>message 只有記錄 Field Gateway 的 ID，Clould 只認得 Field Gateway，此種 Gateway 就是不透明的(opaque)。</p>
<h4 id="Microsoft支援"><a href="#Microsoft支援" class="headerlink" title="Microsoft支援"></a>Microsoft支援</h4><p>不論 Device 還是 Field Gateway 都是由客戶自行準備的，programing的部分也是客戶自行處理，而 Microsoft 能提供的就是針對終端設備，支援多 OS 及多語言 SDK(lib)，讓現有設備可以順利跟 Azure Clould 做通訊。</p>
<ul>
<li>OS<ul>
<li>Windows</li>
<li>Android</li>
<li>iOS</li>
<li>Linux</li>
<li>RTOS</li>
<li>MBED</li>
</ul>
</li>
<li>SDK<ul>
<li>.NET</li>
<li>C#</li>
<li>JavaScript(Note.js)</li>
<li>C</li>
<li>Java</li>
<li>Python</li>
</ul>
</li>
</ul>
<h4 id="通訊-protocol"><a href="#通訊-protocol" class="headerlink" title="通訊 protocol"></a>通訊 protocol</h4><p>若 Device / Field Gateway 成功 port 上 SDK，則 library 就已經把所需的通訊 protocol 及連線模式都做完了，可直接 call function 使用，但若是 SDK 不相容，Device 端就需自行處理通訊相關的部分，Azure 支援四種 protocol:</p>
<ul>
<li>MQTT: 優先建議，lightweight (最小可到 2 byte), reliable, long polling (連線持續建立，而非每次傳送都重建一次連線)</li>
<li>AMQP: 次之，long polling</li>
<li>HTTP: 協定本身太笨重，帶有太多不必要資訊所以不建議，但因本來就是80443比較不會有防火牆問題</li>
<li>AMQT/MQTT over WebSocket: 若有防火牆問題，使用 WebSocket 可穿透客戶端防火牆</li>
</ul>
<hr>
<img src="/ayablog/2017/02/24/Azure%20IoT%20Wokeshop筆記/MicrosoftAzureIoTPlatform02.png" alt="Microsoft_Azure_架構圖" title="Microsoft_Azure_架構圖">
<h3 id="IoT-Hub"><a href="#IoT-Hub" class="headerlink" title="IoT Hub"></a>IoT Hub</h3><p>Azure Cloud 中直接對現場端的介面，相當於 Cloud Gateway 的角色。</p>
<h4 id="主要工作"><a href="#主要工作" class="headerlink" title="主要工作"></a>主要工作</h4><ul>
<li>對現場端設備雙向通訊，可對設備做讀取及控制，</li>
<li>資料可暫存1-7天</li>
</ul>
<h4 id="收費方式"><a href="#收費方式" class="headerlink" title="收費方式"></a>收費方式</h4><p>三個層級,每隔層級有各自的價錢</p>
<ul>
<li>S1：一個單位(單位可以設1~200): 每天(IDx筆數) = 40萬筆資料 (total$ = S1$+單位數x單位$)</li>
<li>S2：每天(IDx筆數) = 600萬筆資料</li>
<li>S3：每天(IDx筆數) = 3億筆資料</li>
</ul>
<p>傳送之 data 256K 以內算一筆資料，超過257~512K算兩筆，以此類推，需要時可隨時調整單位大小及換層級</p>
<hr>
<img src="/ayablog/2017/02/24/Azure%20IoT%20Wokeshop筆記/MicrosoftAzureIoTPlatform03.png" alt="Microsoft_Azure_架構圖" title="Microsoft_Azure_架構圖">
<h3 id="Real-Time-Processing"><a href="#Real-Time-Processing" class="headerlink" title="Real Time Processing"></a>Real Time Processing</h3><p>這階段的主要工作是從 Iot Hub 撈資料，在存進資料庫前先做初步的處理</p>
<h4 id="Stream-Analytics"><a href="#Stream-Analytics" class="headerlink" title="Stream Analytics"></a>Stream Analytics</h4><ul>
<li>可以即時把感興趣的資料抓出來</li>
<li>可寫SQL Script,SQL可做到的都可以做</li>
<li>一個filter,篩資料後送到某處</li>
</ul>
<h4 id="Event-Processor-Host"><a href="#Event-Processor-Host" class="headerlink" title="Event Processor Host"></a>Event Processor Host</h4><ul>
<li>太複雜的判斷可直接寫程式</li>
<li>是個 SDK,可直接執行的 console 程式</li>
<li>用 SDK 寫程式已經做完protocol溝通(AMQP)的工作了</li>
</ul>
<hr>
<img src="/ayablog/2017/02/24/Azure%20IoT%20Wokeshop筆記/MicrosoftAzureIoTPlatform04.png" alt="Microsoft_Azure_架構圖" title="Microsoft_Azure_架構圖">
<h3 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h3><p>此階段為 Azure 提供的各種型態的資料庫。<br>一般來說資料性質可分成兩種:</p>
<ul>
<li>熱資料:需即時處理</li>
<li>冷資料:不需即時處理</li>
</ul>
<p>以微軟的經驗，客戶通常不會只用一種儲存體，同一筆資料可以同時存到不同的儲存體，在不同的地方做不同的處理。建議完整的資料先存一份檔案(BLOB)，因為在還沒分析之前可能不知道自己要拿這個資料來做甚麼，但要未來要做大數據分析需要收及足夠大量的資料。</p>
<h4 id="BLOB"><a href="#BLOB" class="headerlink" title="BLOB"></a>BLOB</h4><ul>
<li>資料量很大時適用</li>
<li>500T</li>
<li>以「檔案」形式儲存</li>
<li>便宜，容量大</li>
</ul>
<h4 id="SQL-Server"><a href="#SQL-Server" class="headerlink" title="SQL Server"></a>SQL Server</h4><ul>
<li>一般常用的資料庫</li>
<li>適合用來做報表</li>
</ul>
<h4 id="QUEUE"><a href="#QUEUE" class="headerlink" title="QUEUE"></a>QUEUE</h4><ul>
<li>需要與異質系統溝通</li>
<li>類似一個信箱</li>
</ul>
<h4 id="Document-DB"><a href="#Document-DB" class="headerlink" title="Document DB"></a>Document DB</h4><ul>
<li>大量,頻繁,單獨物件查詢</li>
<li>若要用 join 這種交叉查詢請用 SQL server</li>
</ul>
<h4 id="Event-Hub"><a href="#Event-Hub" class="headerlink" title="Event Hub"></a>Event Hub</h4><ul>
<li>和 QUEUE 角色很像</li>
<li>需要與異質系統溝通</li>
<li>類似一個信箱</li>
<li>throuthput 比 QUEUE 高，百萬等級</li>
</ul>
<h4 id="Data-Factory"><a href="#Data-Factory" class="headerlink" title="Data Factory"></a>Data Factory</h4><ul>
<li>雲端版SSIS(<a href="https://en.wikipedia.org/wiki/SQL_Server_Integration_Services" target="_blank" rel="external">SQL Server Integration Services</a>)</li>
<li>和SSIS不同，可以有些資料在雲端有些資料在地端, SSIS 則一定要全部在雲端或是全在地端</li>
<li>適合需要排程的資料搬移情境,最小單位是 15min, so不適合即時處理</li>
</ul>
<hr>
<img src="/ayablog/2017/02/24/Azure%20IoT%20Wokeshop筆記/MicrosoftAzureIoTPlatform05.png" alt="Microsoft_Azure_架構圖" title="Microsoft_Azure_架構圖">
<h3 id="Analytics-amp-Presentation"><a href="#Analytics-amp-Presentation" class="headerlink" title="Analytics &amp; Presentation"></a>Analytics &amp; Presentation</h3><p>這個階段是將收集到的大量資料做後續處理，大數據分析，或是以使用者感興趣的方式呈現。</p>
<h4 id="Power-BI"><a href="#Power-BI" class="headerlink" title="Power BI"></a>Power BI</h4><ul>
<li>微軟雲端報表工具</li>
<li>用拖拉的方式建報表</li>
<li>付費版本資料有即時push，可當作 dashboard 使用</li>
<li>免費版本 20~30m 才 refresh 一次</li>
</ul>
<h4 id="Azure-ML"><a href="#Azure-ML" class="headerlink" title="Azure ML"></a>Azure ML</h4><ul>
<li>機器學習</li>
<li>可以”預測”一些事情</li>
<li>需有足夠的資料量才能”學習”</li>
<li>doman專家</li>
<li>資料科學家:(把大量資料+doman專家的知識)轉化成數學模型,再用大量資料去training,一直修改模型</li>
<li>機器學習最欠缺的是資料科學家，需要時微軟也可提供支援</li>
</ul>
<hr>
<img src="/ayablog/2017/02/24/Azure%20IoT%20Wokeshop筆記/MicrosoftAzureIoTPlatform06.png" alt="Microsoft_Azure_架構圖" title="Microsoft_Azure_架構圖">
<h3 id="Process-Automation"><a href="#Process-Automation" class="headerlink" title="Process Automation"></a>Process Automation</h3><p>流程自動化階段，概括來說就是，根據得到的資料判斷後，做後續「處理動作」的階段，也包含以 Web 以及 APP 介接的處理。</p>
<h4 id="Logic-APP"><a href="#Logic-APP" class="headerlink" title="Logic APP"></a>Logic APP</h4><ul>
<li>視覺化工具</li>
<li>用拖拉元件的方式寫介面</li>
</ul>
<h4 id="Web-Apps"><a href="#Web-Apps" class="headerlink" title="Web Apps"></a>Web Apps</h4><ul>
<li>Web hosting</li>
<li>可直接從 Iot hub 讀資料(跳過中間步驟) show 在網站上</li>
</ul>
<h4 id="Mobile-Apps"><a href="#Mobile-Apps" class="headerlink" title="Mobile Apps"></a>Mobile Apps</h4><ul>
<li>APP 後台</li>
<li>用一些方式幫你把 API &amp; 資料庫建好</li>
</ul>
<hr>
<h2 id="結語"><a href="#結語" class="headerlink" title="結語"></a>結語</h2><p>做 IoT 第一個會遇到的挑戰是設備連線的問題，而硬體設備連線大部分是SSL問題。另外資料上雲端一定會稍微延遲，需允許2~3秒的延遲，如果需要做到「真正」的即時，通常是直接在 field gateway 上處理。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://docs.microsoft.com/en-us/azure/iot-suite/iot-security-architecture" target="_blank" rel="external">Internet of Things security architecture</a></li>
<li><a href="https://channel9.msdn.com/Azure" target="_blank" rel="external">Azure@Channel 9</a></li>
<li><a href="https://azure.microsoft.com/zh-tw/updates/" target="_blank" rel="external">Service Update</a></li>
<li>Azure IOT Blogs<ul>
<li><a href="https://dotblogs.com.tw/maduka/series/1?qq=Azure" target="_blank" rel="external">Blog1</a>: 一個從2016年3月開始的實際專案，有建置時的詳細步驟記錄</li>
<li><a href="http://blog.michaelchi.net/" target="_blank" rel="external">Blog2</a>: 講師自己的Blog，記錄客戶Q&amp;A</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/Azure/">Azure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/IoT/">IoT</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-製作個人風格的 Hexo Themes"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/ayablog/2017/02/13/製作個人風格的 Hexo Themes/">製作個人風格的 Hexo Theme</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/ayablog/2017/02/13/製作個人風格的 Hexo Themes/" class="article-date">
	  <time datetime="2017-02-12T16:00:00.000Z" itemprop="datePublished">February 13, 2017</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="第一階段目標"><a href="#第一階段目標" class="headerlink" title="第一階段目標"></a>第一階段目標</h3><p>套用現成別人寫好的版面，試著看看別人版面的寫法，再找出可以修改字型顏色大小、版面長寬的地方，為自己的版面做微調。</p>
<h3 id="套用現成的-Theme"><a href="#套用現成的-Theme" class="headerlink" title="套用現成的 Theme"></a>套用現成的 Theme</h3><p>學習一個新的東西，最快的方式就是模仿。所以我是先套用一個別人寫好現成的 theme，再慢慢修改成自己的風格。試了很多 theme，我最後選擇 <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank" rel="external">hipaper</a>，簡單大方排版符合我的需求， code 又不會太複雜的 theme 做為基礎來修改。</p>
<p>檢查一下 hipaper 的 <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper/blob/master/LICENSE" target="_blank" rel="external">License</a>，是 <a href="https://zh.wikipedia.org/wiki/MIT%E8%A8%B1%E5%8F%AF%E8%AD%89" target="_blank" rel="external">MIT授權</a> 所以可以任意修改使用，只要附上此許可聲明即可。</p>
<p>Hexo Theme 的套用方式照著 hipaper 的 README 做就行了。</p>
<h3 id="解析-hipaper-Themes-Source-Code"><a href="#解析-hipaper-Themes-Source-Code" class="headerlink" title="解析 hipaper Themes Source Code"></a>解析 hipaper Themes Source Code</h3><p>首先，先來了解一下這個專案的整體架構：<br>在 cmd 打入下列指令，可以得到資料夾內容樹狀圖</p>
<pre><code>tree /F hipaper資料夾路徑 &gt; .\tree.txt
</code></pre><p>打開 tree.txt 可得到如下樹狀圖：</p>
<img src="/ayablog/2017/02/13/製作個人風格的%20Hexo%20Themes/tree.png" alt="tree" title="tree">
<p>從以上樹狀架構圖中可以發現，除了圖片資源(.png .jpg .ico)、字型檔(\source\css\fonts)和翻譯對照檔(\languages)之外，source code 的部分包含四種類型檔案：.js .ejs .css .styl，所以要先知道這四種類型檔案在幹嘛</p>
<h4 id="css"><a href="#css" class="headerlink" title=".css"></a>.css</h4><p>這應該不用解釋，就是 CSS 語言寫成的檔案。</p>
<h4 id="styl"><a href="#styl" class="headerlink" title=".styl"></a>.styl</h4><p>Stylus 是一個 Node.js 架構下的 CSS 前處理器，是一種程式語言，它簡化了 CSS 語法再加入函數與運算的功能，讓使用上更加彈性。<br>以 Stylus 程式語言撰寫的檔案，附檔名為 .styl。</p>
<p>與 CSS 的對照語法請參考：</p>
<ul>
<li><a href="http://blogger.gtwang.org/2014/02/stylus-css-preprocessor-based-on-nodejs.html" target="_blank" rel="external">Stylus：Node.js 架構下的 CSS 前處理器</a></li>
<li><a href="http://stylus-lang.com/" target="_blank" rel="external">Stylus 官網</a></li>
</ul>
<p>所以 Stylus 可以直接翻譯成 CSS，也就是說這兩種類型的檔案主要功用是相同的，就是做靜態網頁的圖文格式設定及排版。</p>
<h4 id="js"><a href="#js" class="headerlink" title=".js"></a>.js</h4><p>就是javascript的附檔名。</p>
<h4 id="ejs"><a href="#ejs" class="headerlink" title=".ejs"></a>.ejs</h4><p>EJS 為 Effective JavaScript 的縮寫，是一種可以內嵌在 HTML 程式的 JavaScript 函式庫，因為程式主架構還是 HTML，所以比起用 JavaScript 來產生 HTML 程式碼，在讀程式碼時，網頁架構比較明確易讀，也比較好維護。</p>
<p>EJS 使用 <strong>&lt;% %&gt;</strong> 或 <strong>[% %]</strong> 作為內崁 JavaScript 的關鍵符號，也就是說放在這中間的部分就會被視為 JavaScript 來執行，另外如果放在 <strong>&lt;%= %&gt;</strong> 裡面的 JavaScript 變數，則會以 toString() 的方式將其轉換為字串，並加入至網頁中。</p>
<p>其他內容請參考：</p>
<ul>
<li><a href="https://blog.gtwang.org/programming/ejs-embedded-javascript/" target="_blank" rel="external">EJS：Client 端嵌入式（Embedded）JavaScript</a></li>
<li><a href="http://ejs.co/" target="_blank" rel="external">EJS 官網</a></li>
</ul>
<h4 id="Bootstrap"><a href="#Bootstrap" class="headerlink" title="Bootstrap"></a>Bootstrap</h4><p>Bootstrap 是我在看網路文章時看到的軟體工具，覺得這個字很眼熟，才發現 hipaper theme 就是用 Bootstrap 架構寫的。</p>
<blockquote>
<p>Bootstrap is the most popular HTML, CSS, and JS framework for developing responsive, mobile first projects on the web.</p>
</blockquote>
<p>這句話是 <a href="http://getbootstrap.com/" target="_blank" rel="external">Bootstrap 官網</a>對 Bootstrap 的介紹。</p>
<p>Bootstrap是一個免費開源的開發網站工具，一個 CSS Framework，由知名的社群平台Twitter所開發，無論在結構還是互動性上都相當的完整，可幫助開發者快速開發一個擁有自適應性(responsive web design, RWD)特性的網站。</p>
<ul>
<li><a href="http://phoebelin0606.pixnet.net/blog/post/360332817-%E2%99%8C%E7%A8%8B%E5%BC%8F-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8bootstrap" target="_blank" rel="external">程式-如何使用Bootstrap</a></li>
<li><a href="https://www.minwt.com/webdesign-dev/html/9966.html" target="_blank" rel="external">Bootstrap教學《Bootstrap網設必備》打造Responsive Web Design自適應版型入門|梅問題．教學網</a></li>
<li><a href="http://cythilya.blogspot.tw/2015/02/bootstrap-rwd-template.html" target="_blank" rel="external">使用Bootstrap建立一個RWD Template (Twitter Bootstrap in Responsive Web Design)</a></li>
<li><a href="https://kkbruce.tw/bs3" target="_blank" rel="external">Bootstrap</a></li>
</ul>
<h2 id="待續…"><a href="#待續…" class="headerlink" title="待續…"></a>待續…</h2>
      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/CSS/">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/EJS/">EJS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/Hexo/">Hexo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/Stylus/">Stylus</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-TOEIC準備心得"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/ayablog/2017/02/06/TOEIC準備心得/">TOEIC準備心得</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/ayablog/2017/02/06/TOEIC準備心得/" class="article-date">
	  <time datetime="2017-02-06T03:11:06.036Z" itemprop="datePublished">February 6, 2017</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="短期記憶-與-長期記憶-理論"><a href="#短期記憶-與-長期記憶-理論" class="headerlink" title="短期記憶 與 長期記憶 理論"></a>短期記憶 與 長期記憶 理論</h3><p>忘記一開始是從哪裡看到的背單字方法，但我開始遵循這個理論之後，不但學英文的心理壓力變小，效率也變好，而且這套理論不只適用在背單字，在學習各類知識上都非常有用。</p>
<p>以下截錄自<a href="http://myet.pixnet.net/blog/post/31769968--%E3%80%90%E8%AA%9E%E8%A8%80%E5%AD%B8%E7%BF%92%E3%80%91%E5%AD%B8%E5%96%AE%E5%AD%97%E7%9A%84%E6%96%B9%E6%B3%95" target="_blank" rel="external">【語言學習】學單字的方法</a></p>
<blockquote>
<p>人類的記憶有所謂的<strong>長期記憶（Long-term Memory, LTM）</strong>與<strong>短期記憶（Short-term Memory）</strong>的區別。在長期記憶區裡的知識，會跟隨我們很長一段時間，甚至於一輩子；而在短期記憶區內的知識，很快就會被遺忘。想要有效的學習英文單字，最重要的就是要讓英文單字進入你的長期記憶區。</p>
<p>而要讓一個英文單字進入長期記憶區，基本上有兩種策略：第一增是增加記憶的強度，第二是採用有系統的重複學習，也就是所謂的<strong>「間格重複」（Spaced Repetition）</strong>的技巧。</p>
</blockquote>
<p>所謂的「間格重複」技巧，白話的解釋就是<strong>短時間內重複看到很多次</strong>，其實也是很簡單的技巧，但我們要做的就是，每隔一段時間就回頭檢視一下自己的學習方式是否有真正的實踐「短時間內多次複習」這件事。</p>
<p>記住，<strong>匆匆讀過很多遍</strong>絕對比<strong>仔細讀過一遍</strong>更容易加深記憶！</p>
<h3 id="單字"><a href="#單字" class="headerlink" title="單字"></a>單字</h3><p>我個人的心得是，不要<strong>特地</strong>去背單字。<br>特地是指買一本單字書從頭背到尾，我以前也買過很多口袋單字本，或是前面是字典後面有單句練習題那種，但真的效率很差，不只是壓力很大無法持續，而且很快就忘了。<br>針對準備TOEIC，我現在都是從題目裡去背單字，大概寫個完整的五回模擬試題(回數可能看自己原本的單字量會有差異)，就會有感覺TOEIC會出的單字就那些，不但練到題目也背到單字，一舉多得!<br>而且現在買到的題庫都有設計過，在同一回測驗裡的不同文章會重複用到特定的幾個單字，也可達到<strong>「短時間內多次複習」</strong>的效果。</p>
<h3 id="文法"><a href="#文法" class="headerlink" title="文法"></a>文法</h3><p>推薦這本 <a href="http://www.books.com.tw/products/0010483241" target="_blank" rel="external">NEW TOEIC TEST金色證書-文法</a>，這本的優點就是很薄，只講重點文法，而且是用很有邏輯的方式解說，而不是叫你死背。<br>看完這本其他需要特別背的瑣碎文法就在寫模擬測驗時遇到再記就好。</p>
<h3 id="聽力"><a href="#聽力" class="headerlink" title="聽力"></a>聽力</h3><p>我目前試過最有效的方法是看美劇，因為同一部美劇內的角色習慣的說話方式，才能<strong>重複複習同個領域的用詞</strong>，加深記憶，如果是看很多部不同的電影可能就沒有這種效果。<br>有人推薦<a href="http://mrguoyi.pixnet.net/blog/post/12930046-%E9%83%AD%E6%98%93%E8%80%81%E5%B8%AB%E8%AB%96%E2%97%8E%E5%88%A9%E7%94%A8%E8%8B%B1%E7%BE%8E%E5%BD%B1%E9%9B%86%E9%9B%BB%E5%BD%B1%E5%AD%B8%E8%8B%B1%E6%96%87%E4%B9%8B%E3%80%8C%E4%B8%AD" target="_blank" rel="external">中英無三遍法學習法</a>，但我自己很不喜歡同樣的內容看第二次，所以就是找集數很多的美劇，可以的話再搭配中英同時顯示的字幕。</p>
<p>挑美劇的重點:</p>
<ul>
<li>很多季，集數多，但每集短(約20min)</li>
<li>針對TOEIC愛考的題型，挑職場類或生活化的劇</li>
<li>自己有興趣的內容，才能不由自主一直看下去，當消遣同時也練英聽</li>
</ul>
<p>我個人推薦How I Met Your Mother(共9季)和Drop Dead Diva(共6季)，輕鬆好笑可以一集接一集，另外還有Friends(共10季)也是很多人推薦練英聽的好劇。</p>
<h3 id="閱讀"><a href="#閱讀" class="headerlink" title="閱讀"></a>閱讀</h3><p>針對TOEIC題型的答題技巧很多人都寫過了，所以我這邊就直接提供我覺得不錯的文章連結:</p>
<ul>
<li><a href="https://www.ptt.cc/bbs/TOEIC/M.1350067481.A.B3C.html" target="_blank" rel="external">[心得] 落落長的心得文 940 495/445</a></li>
<li><a href="http://b.bbi.com.tw/TOEIC/1Godtg8w.html" target="_blank" rel="external">[心得] 一個月 TOEIC 845-&gt;950 </a></li>
</ul>
<p>再來就是寫題庫，寫題庫，寫題庫!!!<br>並且盡量寫完後在一兩天內訂正完，才能達到從短期記憶轉變為長期記憶的效果。<br>一開始會錯很多，訂正會很痛苦，但一定要認真訂正，不然一直錯一樣的地方反而會把錯的選項越記越牢喔。</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>灰心喪志時可以多看PTT TOEIC版，多看看別人分享的心得及讀書技巧，會發現大家都是這麼走過來的，可以重新燃起鬥志喔!!<br>我也是準備後期才發現這個版的，有種相見恨晚的感覺。</p>
<blockquote>
<p>PTT TOEIC版：主選單&gt;分組討論區&gt;國家研究院&gt;語言研究院&gt;TOEIC</p>
</blockquote>
<p><a href="https://www.youtube.com/watch?v=EXpY1YAt1to" target="_blank" rel="external">五個訣竅 提升英文學習效能 // 5 Tips to Improve English Learning</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/心得/">心得</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-不定長度引數function寫法"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/ayablog/2017/01/10/不定長度引數function寫法/">不定長度引數函數的寫法</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/ayablog/2017/01/10/不定長度引數function寫法/" class="article-date">
	  <time datetime="2017-01-10T09:21:51.599Z" itemprop="datePublished">January 10, 2017</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>把開 特定檔案、寫入帶有當下時間的log、關檔案 整個流程寫成一個function，且此function要有像printf的介面，可以自動偵測印出含有任意數量的變數的string。</p>
<h3 id="Sample-Code"><a href="#Sample-Code" class="headerlink" title="Sample Code"></a>Sample Code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">printLog</span><span class="params">(<span class="keyword">char</span>* hex, <span class="keyword">int</span> len, <span class="keyword">char</span>* char_p, ...)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> i;</div><div class="line">	FILE *fp;</div><div class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>* hex_p = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)hex;</div><div class="line"></div><div class="line">	fp = fopen(LOGFILE, <span class="string">"a"</span>);</div><div class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == fp)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"open %s fail\n"</span>, LOGFILE);</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	&#125;	</div><div class="line">	</div><div class="line">	<span class="keyword">char</span> buffer[<span class="number">256</span>];</div><div class="line">	va_list list_p;</div><div class="line">	va_start(list_p, char_p);</div><div class="line">	<span class="built_in">vsprintf</span>(buffer, char_p, list_p);</div><div class="line">	va_end(list_p);</div><div class="line">	</div><div class="line">	<span class="comment">//print time stamp</span></div><div class="line">	<span class="built_in">fprintf</span>(fp, <span class="string">"%.24s   "</span>, getTime()); </div><div class="line">	</div><div class="line">	<span class="comment">//print comment with variable-length argument </span></div><div class="line">	<span class="built_in">fprintf</span>(fp, <span class="string">"%s"</span>, buffer);</div><div class="line"></div><div class="line">	<span class="comment">//print hex string	</span></div><div class="line">	<span class="built_in">fprintf</span>(fp, <span class="string">"[ "</span>);</div><div class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">fprintf</span>(fp, <span class="string">"%02x "</span>, *hex_p++);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">fprintf</span>(fp, <span class="string">"]\n"</span>);</div><div class="line">	</div><div class="line">	fclose(fp);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>這段code是reference內sample code變化應用，想知道細節就參考reference吧，裡面寫得很詳細!</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="http://ccd9527.blogspot.tw/2009/04/cc-variable-length-argument.html" target="_blank" rel="external">C/C++ : 不定長度引數（Variable-length argument）</a></p>
<p><a href="http://www.programmer-club.com.tw/ShowSameTitleN/c/33173.html" target="_blank" rel="external">請問像printf()這樣參數數量不固定的函數如何實作? </a></p>
<p><a href="http://www.cplusplus.com/reference/cstdio/vsprintf/" target="_blank" rel="external">vsprintf</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/C/">C</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-如何使用 pthread_create 傳遞多個引數"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/ayablog/2017/01/10/如何使用 pthread_create 傳遞多個引數/">如何使用 pthread_create 傳遞多個引數</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/ayablog/2017/01/10/如何使用 pthread_create 傳遞多個引數/" class="article-date">
	  <time datetime="2017-01-10T01:32:36.719Z" itemprop="datePublished">January 10, 2017</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="函數定義"><a href="#函數定義" class="headerlink" title="函數定義"></a>函數定義</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#include &lt;pthread.h&gt;</div><div class="line">int pthread_create( pthread_t *thread, </div><div class="line">					const pthread_attr_t *attr, </div><div class="line">					void *(*start_routine) (void *),</div><div class="line">					void *arg);</div></pre></td></tr></table></figure>
<ul>
<li><strong>pthread_t *thread</strong> 為pthread的指標，在使用thread之前必須要先宣告一個pthread_t的變數。</li>
<li><strong>const pthread_attr_t *attr</strong> 為一個structure指標，內含創建此thread的屬性，預設是NULL，如果沒有其他特殊的需求直接填入NULL即可。</li>
<li><strong>void *(*start_routine) (void *)</strong> 為function pointer，即所創建的thread要執行的handler function。</li>
<li><strong>void *arg</strong> 為Function pointer所指function要帶的參數,需為指標型態。</li>
<li><strong>RETURN VALUE:</strong> 如果執行成功則回傳0，如果執行失敗則回傳錯誤代碼。</li>
</ul>
<h3 id="EX"><a href="#EX" class="headerlink" title="EX:"></a>EX:</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">print_data</span><span class="params">(<span class="keyword">void</span> *data)</span></span>;</div><div class="line">...</div><div class="line"><span class="keyword">pthread_t</span> t1;</div><div class="line"><span class="keyword">int</span> arg1 = <span class="number">5</span>;</div><div class="line">pthread_create( &amp;t1, <span class="literal">NULL</span> , print_data , (<span class="keyword">void</span> *)&amp;arg1);</div><div class="line"></div><div class="line">pthread_create( &amp;t1, <span class="literal">NULL</span> , (<span class="keyword">void</span> *)print_data , (<span class="keyword">void</span> *)&amp;arg1);</div></pre></td></tr></table></figure>
<h3 id="傳遞一個引數"><a href="#傳遞一個引數" class="headerlink" title="傳遞一個引數"></a>傳遞一個引數</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">print_data</span><span class="params">(<span class="keyword">void</span> *data)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//printf("data = %d\n", *data);//compile不會過</span></div><div class="line"></div><div class="line">	<span class="keyword">int</span> tt = *(<span class="keyword">int</span>*)data;</div><div class="line"></div><div class="line">	<span class="built_in">printf</span>(<span class="string">"print_data START\n"</span>);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"data = %d\n"</span>, tt);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"print_data END\n"</span>);</div><div class="line"></div><div class="line">	pthread_exit(<span class="literal">NULL</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> arg1 = <span class="number">88</span>;</div><div class="line">	<span class="keyword">pthread_t</span> t1;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (pthread_create(&amp;t1, <span class="literal">NULL</span>, print_data, (<span class="keyword">void</span> *)&amp;arg1) != <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"create thread fail: %s\n"</span>, strerror(errno));</div><div class="line">	&#125;</div><div class="line">	sleep(<span class="number">5</span>); <span class="comment">//避免thread還沒執行完main就結束</span></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>(void *)指標型態的參數傳進function後，需要先指定是甚麼型態的指標才能使用，直接使用指標指向的值，compiler無法判斷要讀多長的記憶體空間，所以連compile都不會過:</p>
<h3 id="Compile-Error"><a href="#Compile-Error" class="headerlink" title="Compile Error:"></a>Compile Error:</h3><pre><code>warning: dereferencing &apos;void *&apos; pointer [enabled by default]
error: invalid use of void expression
</code></pre><h3 id="傳遞多個引數"><a href="#傳遞多個引數" class="headerlink" title="傳遞多個引數"></a>傳遞多個引數</h3><p>pthread_create的函數定義裡，只有一個欄位可以放傳入handler function的引數，所以要傳遞多個引數時，可以把需要的引數包成一個structure，再將此structure的pointer作為引數傳入。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> testdata</div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> num;</div><div class="line">	<span class="keyword">char</span> name[<span class="number">10</span>];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">print_data</span><span class="params">(<span class="keyword">void</span> *data)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">struct</span> testdata* tt = (<span class="keyword">struct</span> testdata*)data;</div><div class="line"></div><div class="line">	<span class="built_in">printf</span>(<span class="string">"print_data START\n"</span>);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"num = %d\n"</span>, tt-&gt;num);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"name = %s\n"</span>, tt-&gt;name);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"print_data END\n"</span>);</div><div class="line"></div><div class="line">	pthread_exit(<span class="literal">NULL</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">struct</span> testdata data1;</div><div class="line">	<span class="keyword">pthread_t</span> t1;</div><div class="line"></div><div class="line">	data1.num = <span class="number">100</span>;</div><div class="line">	<span class="built_in">strcpy</span>(data1.name, <span class="string">"Hello"</span>);</div><div class="line">	</div><div class="line">	<span class="keyword">if</span> (pthread_create( &amp;t1, <span class="literal">NULL</span> , print_data , (<span class="keyword">void</span> *)&amp;data1) != <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"create thread fail: %s\n"</span>, strerror(errno));</div><div class="line">	&#125;</div><div class="line">	sleep(<span class="number">5</span>); <span class="comment">//避免thread還沒執行完main就結束</span></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="pass-by-reference引起的segmentation-fault"><a href="#pass-by-reference引起的segmentation-fault" class="headerlink" title="pass by reference引起的segmentation fault"></a>pass by reference引起的segmentation fault</h3><p>因為受限於pthread_create本身的定義，pthread_create所有的參數都是使用指標，也就是用pass by reference的方式傳遞引數，所以就要特別注意reference的位置是否為NULL，會不會造成segmentation fault。<br>以下例子就是我自己寫multi-thread程式的血淚經驗中得來的:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> testdata</div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> num;</div><div class="line">	<span class="keyword">char</span> name[<span class="number">10</span>];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">print_data</span><span class="params">(<span class="keyword">void</span> *data)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">struct</span> testdata* tt = (<span class="keyword">struct</span> testdata*)data;</div><div class="line"></div><div class="line">	<span class="built_in">printf</span>(<span class="string">"print_data START\n"</span>);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"num = %d\n"</span>, tt-&gt;num);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"name = %s\n"</span>, tt-&gt;name);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"print_data END\n"</span>);</div><div class="line"></div><div class="line">	pthread_exit(<span class="literal">NULL</span>);</div><div class="line">&#125;	</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">struct</span> testdata data1;</div><div class="line">	<span class="keyword">pthread_t</span> t1;</div><div class="line"></div><div class="line">	data1.num = <span class="number">100</span>;</div><div class="line">	<span class="built_in">strcpy</span>(data1.name, <span class="string">"Hello"</span>);</div><div class="line">	</div><div class="line">	<span class="keyword">if</span> (pthread_create( &amp;t1, <span class="literal">NULL</span> , print_data , (<span class="keyword">void</span> *)&amp;data1) != <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"create thread fail: %s\n"</span>, strerror(errno));</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	func();</div><div class="line">	</div><div class="line">	sleep(<span class="number">5</span>); <span class="comment">//避免thread還沒執行完main就結束</span></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="OUTPUT"><a href="#OUTPUT" class="headerlink" title="OUTPUT"></a>OUTPUT</h3><pre><code>print_data START
num = -6947704
name = ��y���Z�u
print_data END
</code></pre><p>以上程式有很大的機率會在執行時發生segmentation fault，原因是傳入的引數data1是定義在func()內，func()一結束區域變數data1就會被系統清除，而此時thread進行到<br><code>printf(&quot;num = %d\n&quot;, tt-&gt;num);</code><br>這行時，就會讀錯記憶體區塊，造成segmentation fault。</p>
<h3 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h3><p>雖然所有pthread_create的動作都在main進行是最安全的作法，但程式越來越大，為了使程式結構化寫成function還是有必要的。所以我目前的解法是在thread handler function內一開始就把傳入指標指向的值copy一份，另外在pthread_create後也稍微delay確保copy引數值的動作完成才結束func()。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> testdata</div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> num;</div><div class="line">	<span class="keyword">char</span> name[<span class="number">10</span>];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">print_data</span><span class="params">(<span class="keyword">void</span> *data)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">struct</span> testdata tt = *(<span class="keyword">struct</span> testdata*)data; <span class="comment">// 直接copy值，而不是用reference的方法使用</span></div><div class="line"></div><div class="line">	<span class="built_in">printf</span>(<span class="string">"print_data START\n"</span>);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"num = %d\n"</span>, tt.num);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"name = %s\n"</span>, tt.name);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"print_data END\n"</span>);</div><div class="line"></div><div class="line">	pthread_exit(<span class="literal">NULL</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">struct</span> testdata data1;</div><div class="line">	<span class="keyword">pthread_t</span> t1;</div><div class="line"></div><div class="line">	data1.num = <span class="number">100</span>;</div><div class="line">	<span class="built_in">strcpy</span>(data1.name, <span class="string">"Hello"</span>);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (pthread_create(&amp;t1, <span class="literal">NULL</span>, print_data, (<span class="keyword">void</span> *)&amp;data1) != <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"create thread fail: %s\n"</span>, strerror(errno));</div><div class="line">	&#125;</div><div class="line">	usleep(<span class="number">500000</span>);<span class="comment">//確保copy引數值的動作完成才結束func()</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	func();</div><div class="line"></div><div class="line">	sleep(<span class="number">5</span>); <span class="comment">//避免thread還沒執行完main就結束</span></div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="OUTPUT-1"><a href="#OUTPUT-1" class="headerlink" title="OUTPUT"></a>OUTPUT</h3><pre><code>print_data START
num = 100
name = Hello
print_data END
</code></pre><p>當然，這不是最好的做法，畢竟做了delay，如果有發現更好的做法再來更新吧!</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/C/">C</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/pthread/">pthread</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-如何外部終止特定執行緒"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/ayablog/2017/01/05/如何外部終止特定執行緒/">如何外部終止特定執行緒</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/ayablog/2017/01/05/如何外部終止特定執行緒/" class="article-date">
	  <time datetime="2017-01-05T01:46:25.748Z" itemprop="datePublished">January 5, 2017</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>主程式會不定時創建 5 個執行緒執行工作A~E, 當主程式需執行A工作時，需先判斷上一輪的A是否結束，若還沒結束就需先強制終止掉正在進行A的執行緒後，再創建一個新的執行緒執行這次的工作A。</p>
<h3 id="問題"><a href="#問題" class="headerlink" title="問題"></a>問題</h3><p>使用pthread_cancel()來外部終止執行緒是以pthread_id來識別，但pthread_id是類似file descriptor的識別碼，只要空了就可以重複使用，所以有可能上一輪的A已經結束，而此pthread_id被後來創建的執行緒C拿去用。所以用pthread_id在多執行緒的環境中無法識別執行特定工作的執行緒是否還沒結束，也就是說，用pthread_cancel()可能會終止掉非目標的執行緒，造成程式錯誤。</p>
<h3 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h3><p>不使用pthread_id來識別執行緒，而是自己定義一個陣列記錄每個執行緒目前的狀態。但此陣列可能同時被多個執行緒存取，造成race condition, 所以需再加上mutex做保護。</p>
<h3 id="Sameple-code"><a href="#Sameple-code" class="headerlink" title="Sameple code"></a>Sameple code</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DEV_MAX 5</span></div><div class="line"><span class="keyword">volatile</span> <span class="keyword">int</span> SendTrigThreadStop[DEV_MAX] = &#123; <span class="number">0</span> &#125;;</div><div class="line"><span class="keyword">pthread_mutex_t</span> TrigStopMutex[DEV_MAX];</div><div class="line"><span class="keyword">pthread_t</span> thread_SendTrigMsg[DEV_MAX];</div><div class="line"></div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">void</span> *<span class="title">func</span><span class="params">(<span class="keyword">void</span> *param)</span></span></div><div class="line">	&#123;	</div><div class="line">		<span class="comment">//pthread_detach(pthread_self());</span></div><div class="line">		<span class="comment">//在pthread_create後，在thread function中pthread_detach自己,資源在thread function退出時或調用pthread_exit()時會自動被釋放</span></div><div class="line">		<span class="comment">//加了這行就不能被join了</span></div><div class="line">		</div><div class="line">	</div><div class="line">		<span class="keyword">int</span> num = (<span class="keyword">int</span>)param;</div><div class="line">		<span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"thread %d begin...\n"</span>, num);</div><div class="line">	</div><div class="line">	</div><div class="line">		<span class="keyword">while</span> (getTrigThreadStat(num) == <span class="number">0</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"thread[%d]: %d\n"</span>, num, count++);</div><div class="line">			sleep(<span class="number">1</span>);</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"thread %d end...\n"</span>, num);</div><div class="line">		</div><div class="line">		pthread_exit(<span class="literal">NULL</span>);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getTrigThreadStat</span><span class="params">(<span class="keyword">int</span> dev_n)</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">	</div><div class="line">			pthread_mutex_lock(&amp;TrigStopMutex[dev_n]);</div><div class="line">			ret = SendTrigThreadStop[dev_n];</div><div class="line">			pthread_mutex_unlock(&amp;TrigStopMutex[dev_n]);</div><div class="line">	</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setTrigThreadStat</span><span class="params">(<span class="keyword">int</span> dev_n, <span class="keyword">int</span> val)</span></span></div><div class="line">	&#123;</div><div class="line">			pthread_mutex_lock(&amp;TrigStopMutex[dev_n]);</div><div class="line">			SendTrigThreadStop[dev_n] = val;</div><div class="line">			pthread_mutex_unlock(&amp;TrigStopMutex[dev_n]);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> i;</div><div class="line">		<span class="keyword">int</span> thread_n = <span class="number">3</span>;</div><div class="line">		<span class="comment">// start thread</span></div><div class="line">		<span class="keyword">if</span> (pthread_create(&amp;thread_SendTrigMsg[thread_n], <span class="literal">NULL</span>, func, (<span class="keyword">void</span>*)thread_n)) </div><div class="line">		&#123;</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"pthread_create %d error\n"</span>, thread_n);</div><div class="line">			<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">		&#125;</div><div class="line">	</div><div class="line">		sleep(<span class="number">5</span>);</div><div class="line">	</div><div class="line">	</div><div class="line">		setTrigThreadStat(thread_n, <span class="number">1</span>);</div><div class="line">		pthread_join(thread_SendTrigMsg[thread_n], <span class="literal">NULL</span>);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"main canceled thread %d\n\n"</span>, thread_n);</div><div class="line">		setTrigThreadStat(thread_n, <span class="number">0</span>);</div><div class="line">	</div><div class="line">		thread_n = <span class="number">1</span>;</div><div class="line">		<span class="keyword">if</span> (pthread_create(&amp;thread_SendTrigMsg[thread_n], <span class="literal">NULL</span>, func, (<span class="keyword">void</span>*)thread_n))</div><div class="line">		&#123;</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"pthread_create %d error\n"</span>, thread_n);</div><div class="line">			<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">		&#125;</div><div class="line">	</div><div class="line">		sleep(<span class="number">8</span>);</div><div class="line">	</div><div class="line">		setTrigThreadStat(thread_n, <span class="number">1</span>);</div><div class="line">		pthread_join(thread_SendTrigMsg[thread_n], <span class="literal">NULL</span>);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"main canceled thread %d\n\n"</span>, thread_n);</div><div class="line">		setTrigThreadStat(thread_n, <span class="number">0</span>);</div><div class="line">	</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="http://stackoverflow.com/questions/18826853/how-to-stop-a-running-pthread-thread" target="_blank" rel="external">How to stop a running pthread thread?</a></p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/C/">C</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/pthread/">pthread</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-Linux Command"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/ayablog/2016/12/25/Linux Command/">Linux Command</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/ayablog/2016/12/25/Linux Command/" class="article-date">
	  <time datetime="2016-12-24T16:00:00.000Z" itemprop="datePublished">December 25, 2016</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>這篇整理記錄我自己接觸 Linux 以來所用到的 Command，會一直不斷更新。</p>
<p>因為我一開始是整理成表格，這樣簡短的指令比較能清楚呈現，但 Markdown 的表格語法實在太難用啦!!!目前還沒想到好的表達方式，所以就先放個 Google Drive 連結吧。</p>
<h3 id="Linux-Command"><a href="#Linux-Command" class="headerlink" title="Linux Command"></a><a href="https://drive.google.com/file/d/0B3tpptLFunv1dlFtT1NoZ1ZFc1U/view?usp=sharing" target="_blank" rel="external">Linux Command</a></h3>
      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/linux/">linux</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-如何讓VM開機自動執行"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/ayablog/2016/12/23/如何讓VM開機自動執行/">讓Virtualbox 的虛擬機器在 Windows 開機後自動啟動</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/ayablog/2016/12/23/如何讓VM開機自動執行/" class="article-date">
	  <time datetime="2016-12-22T16:00:00.000Z" itemprop="datePublished">December 23, 2016</time>
	</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>有一個在linux環境執行的server,以VM的方式架在Windows的PC上，所以希望PC開完機後自動執行此VM。</p>
<h3 id="操作步驟如下："><a href="#操作步驟如下：" class="headerlink" title="操作步驟如下："></a>操作步驟如下：</h3><h3 id="1-查看虛擬機器名稱"><a href="#1-查看虛擬機器名稱" class="headerlink" title="1. 查看虛擬機器名稱"></a>1. 查看虛擬機器名稱</h3><p>開啟Oracle VM VirtualBox，確認虛擬機器名稱，在此例中虛擬機器叫做 “server_VM”</p>
<img src="/ayablog/2016/12/23/如何讓VM開機自動執行/VM_start_01.jpg" alt="VM_start_01.jpg" title="">
<p>另外也可以用command line的方式查詢(以後可寫成script檔)</p>
<pre><code>開啟命令提示字元
進入安裝Oracle VM VirtualBox資料夾
輸入指令 VBoxManage list vms
</code></pre><img src="/ayablog/2016/12/23/如何讓VM開機自動執行/VM_start_02.jpg" alt="VM_start_02.jpg" title="">
<h3 id="2-建立bat檔"><a href="#2-建立bat檔" class="headerlink" title="2. 建立bat檔"></a>2. 建立bat檔</h3><p>用notepad.exe建立一個副檔名為 bat 的檔案，然後將下面這一行指令給放進去。</p>
<pre><code>VBoxManage startvm server_VM
</code></pre><img src="/ayablog/2016/12/23/如何讓VM開機自動執行/VM_start_03.jpg" alt="VM_start_03.jpg" title="">
<h3 id="3-將-bat-檔放到「啟動」資料夾"><a href="#3-將-bat-檔放到「啟動」資料夾" class="headerlink" title="3. 將 bat 檔放到「啟動」資料夾"></a>3. 將 bat 檔放到「啟動」資料夾</h3><p>每台電腦的「啟動」資料夾路徑可能不同，但win7可以從「開始」功能表找到「啟動」資料夾</p>
<pre><code>開始&gt;&gt; 所有程式&gt;&gt; 啟動&gt;&gt; 右鍵&gt;&gt; 開啟
</code></pre><p>然後直接把準備好的bat檔放進去即可。</p>
<img src="/ayablog/2016/12/23/如何讓VM開機自動執行/VM_start_04.jpg" alt="VM_start_04.jpg" title="">
<img src="/ayablog/2016/12/23/如何讓VM開機自動執行/VM_start_05.jpg" alt="VM_start_05.jpg" title="">

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/Windows/">Windows</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/ayablog/tags/小技巧/">小技巧</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  


</section>
          <aside id="sidebar">
  
    <div style="margin: 20px 0;">
	<div id="search-form-wrap">

    <form class="search-form">
        <label style="width: 72%;">
            <span class="screen-reader-text">Search for:</span>
            <input type="search" class="search-field" style="height: 36px; width: 100%;" placeholder=" Search…" value="" name="s" title="Search for:">
        </label>
        <input type="submit" class="search-form-submit" value="Search">
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/ayablog/',
        CONTENT_URL: '/ayablog/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/ayablog/js/insight.js"></script>

</div>
</div>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Connect With Us</h3>
    <div class="widget widget_athemes_social_icons">

    	<ul class="clearfix widget-social-icons">   
    	
   			<li><a href="https://github.com/cathy1666" title="Github"><i class="fa fa-github" aria-hidden="true"></i></a></li> 

   		
   		</ul>


   		<!--
   		<ul class="clearfix widget-social-icons">   		
   		<li class="widget-si-twitter"><a href="http://twitter.com" title="Twitter"><i class="ico-twitter"></i></a></li> 
		<li class="widget-si-facebook"><a href="http://facebook.com" title="Facebook"><i class="ico-facebook"></i></a></li>
			<li class="widget-si-gplus"><a href="http://plus.google.com" title="Google+"><i class="ico-gplus"></i></a></li>
			<li class="widget-si-pinterest"><a href="http://pinterest.com" title="Pinterest"><i class="ico-pinterest"></i></a></li>
			<li class="widget-si-flickr"><a href="http://flickr.com" title="Flickr"><i class="ico-flickr"></i></a></li>
			<li class="widget-si-instagram"><a href="http://instagram.com" title="Instagram"><i class="ico-instagram"></i></a></li>
		</ul> -->

    </div>
  </div>


  
    
  <div class="widget_athemes_tabs">
    <ul id="widget-tab" class="clearfix widget-tab-nav">
      <li class="active"><a>Recent Posts</a></li>
    </ul>
    <div class="widget">
      <ul>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/ayablog/2017/02/24/Azure IoT Wokeshop筆記/">Azure IoT Wokeshop筆記</a></h6>
              <span>February 24, 2017</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/ayablog/2017/02/13/製作個人風格的 Hexo Themes/">製作個人風格的 Hexo Theme</a></h6>
              <span>February 13, 2017</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/ayablog/2017/02/06/TOEIC準備心得/">TOEIC準備心得</a></h6>
              <span>February 6, 2017</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/ayablog/2017/01/10/不定長度引數function寫法/">不定長度引數函數的寫法</a></h6>
              <span>January 10, 2017</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/ayablog/2017/01/10/如何使用 pthread_create 傳遞多個引數/">如何使用 pthread_create 傳遞多個引數</a></h6>
              <span>January 10, 2017</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/ayablog/2017/01/05/如何外部終止特定執行緒/">如何外部終止特定執行緒</a></h6>
              <span>January 5, 2017</span>
            </div>

          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/ayablog/tags/Azure/" style="font-size: 10px;">Azure</a> <a href="/ayablog/tags/C/" style="font-size: 20px;">C</a> <a href="/ayablog/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/ayablog/tags/EJS/" style="font-size: 10px;">EJS</a> <a href="/ayablog/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/ayablog/tags/IoT/" style="font-size: 10px;">IoT</a> <a href="/ayablog/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/ayablog/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/ayablog/tags/Stylus/" style="font-size: 10px;">Stylus</a> <a href="/ayablog/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/ayablog/tags/linux/" style="font-size: 10px;">linux</a> <a href="/ayablog/tags/pthread/" style="font-size: 15px;">pthread</a> <a href="/ayablog/tags/小技巧/" style="font-size: 10px;">小技巧</a> <a href="/ayablog/tags/心得/" style="font-size: 10px;">心得</a>
    </div>
  </div>

  
</aside>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/ayablog/" class="mobile-nav-link">Home</a>
  
    <a href="/ayablog/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/ayablog/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/ayablog/about" class="mobile-nav-link">About</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2017 Aya Blog All Rights Reserved.
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
    
</script>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/ayablog/fancybox/jquery.fancybox.css">
  <script src="/ayablog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/ayablog/js/script.js"></script>
<script src="/ayablog/js/bootstrap.js"></script>
<script src="/ayablog/js/main.js"></script>





  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
  

  <div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>


</body>
</html>
